# Mac build because Windows builds are broken on Travis CI for now  
# and Linux version of Cadius produces invalid disk images
os: osx 

# Fixing Mac version to v10.13 in order to avoid Brew missing formulae in future versions
osx_image: xcode9.4

install:
  - HOMEBREW_NO_AUTO_UPDATE=1 brew install acme rom-tools
  - wget https://www.brutaldeluxe.fr/products/crossdevtools/cadius/Cadius_v1.4_mac.zip
  - unzip ./Cadius_v1.4_mac.zip
  - chmod +x ./cadius
  - export PATH=$PATH:.

script:
  - make dsk chd

deploy:
  provider: releases
  # GITHUB_OAUTH_TOKEN : Travis CI secure variable containing a GitHub Personal Access Token
  #                      with "repo" and "read:repo_hook" scopes
  api_key: $GITHUB_OAUTH_TOKEN
  file: 
    - "build/4cade.2mg"
    - "build/4cade.2mg.chd"
  skip_cleanup: true
  draft: true
  on:
    branch: master
 